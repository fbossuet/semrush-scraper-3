# RÃ¨gles de travail pour la branche test
# ======================================

## ğŸ¯ PRINCIPES FONDAMENTAUX (NON-NÃ‰GOCIABLES)
- **Documentation-First**: TOUJOURS consulter la documentation avant toute action
- **VPS-Only Development**: DÃ©veloppement exclusivement sur le VPS, jamais en local
- **Validation Utilisateur**: L'utilisateur valide chaque modification via test sur le VPS
- **Logs Immutables**: JAMAIS modifier les messages de logs existants
- **Approche Adaptative**: Validation des mÃ©triques par comptage dynamique
- **Pas de Scripts de Test**: JAMAIS crÃ©er de scripts de test - l'utilisateur teste directement sur le VPS
- **Fix Reports Dynamiques**: Les fix reports doivent Ãªtre mis Ã  jour si l'utilisateur fait des modifs durant les tests
- **Nettoyage Post-Validation**: Supprimer les fichiers de test/rapports aprÃ¨s validation utilisateur
- **Scripts de Modification Temporaires**: Supprimer tous les scripts de modification VPS aprÃ¨s validation utilisateur

## ğŸ“ RÃ‰PERTOIRE DE TRAVAIL
- TOUJOURS travailler dans /home/ubuntu/projects/shopshopshops/test/
- NE JAMAIS aller dans /home/ubuntu/trendtrack-scraper-final/ ou autres rÃ©pertoires
- **CHEMINS RELATIFS** : Utiliser os.getcwd() + chemins relatifs pour la portabilitÃ©
- **RÃ‰PERTOIRE DE BASE** : /home/ubuntu/projects/shopshopshops/test/ (rÃ©pertoire de travail)

## ğŸ—„ï¸ BASES DE DONNÃ‰ES
- **Production**: trendtrack-scraper-final/data/trendtrack.db (chemin relatif)
- **Test**: trendtrack-scraper-final/data/trendtrack_test.db (chemin relatif)
- **Structure**: trendtrack_test.db a une structure optimisÃ©e (INTEGER, DATE) vs trendtrack.db (TEXT)
- **Endpoint principal**: Utilise trendtrack.db (production) pour les donnÃ©es rÃ©elles
- **Scraper TrendTrack**: Utilise la base de production (trendtrack.db)

## ğŸš€ API ET ENDPOINTS
- **Fichier**: sem-scraper-final/api_server.py (chemin relatif)
- **Port**: 8001
- **URL**: http://37.59.102.7:8001
- **Endpoint principal**: /test/shops/with-analytics-ordered
- **Structure de retour**: 25 champs dans l'ordre spÃ©cifiÃ© (id, shop_name, category, etc.)
- **Lancement**: Depuis /home/ubuntu/projects/shopshopshops/test/ avec chemins relatifs

## ğŸ”§ COMMANDES DE VÃ‰RIFICATION
- Toujours commencer par: cd /home/ubuntu/projects/shopshopshops/test && pwd
- Utiliser: python3 database_config.py pour vÃ©rifier les chemins
- Utiliser: ./check_workspace.sh pour vÃ©rification complÃ¨te
- Utiliser: python3 workspace_config.py pour configuration centralisÃ©e

## ğŸ“‹ SYSTÃˆME DE TÃ‚CHES
- **Fichier de suivi**: tasks.md (systÃ¨me interne inspirÃ© de git spec check)
- **PrioritÃ©s**: P0 (critique), P1 (important), P2 (normal), P3 (faible)
- **Types**: Bug Fix, Feature, Infrastructure, Documentation, Refactoring
- **Statuts**: En cours, En attente, TerminÃ©e, AnnulÃ©e

## ğŸ› ï¸ WORKFLOW DE DÃ‰VELOPPEMENT
1. **Lecture obligatoire** du guide de dÃ©veloppement
2. **Backup** du fichier Ã  modifier
3. **TÃ©lÃ©chargement** du fichier du VPS
4. **Modification locale** avec outils appropriÃ©s (search_replace, MultiEdit)
5. **VÃ©rification syntaxe** Python (py_compile)
6. **Upload** sur le VPS
7. **VÃ©rification dÃ©ploiement** sur le VPS
8. **Test utilisateur** et validation

## ğŸ¯ STRUCTURE DE L'ENDPOINT FINAL
L'endpoint /test/shops/with-analytics-ordered doit retourner exactement:
- id, shop_name, shop_url, category
- monthly_visits, year_founded, total_products, aov
- pixel_google, pixel_facebook
- organic_traffic, bounce_rate, avg_visit_duration, visits
- branded_traffic, percent_branded_traffic, paid_search_traffic, cpc, conversion_rate
- market_us, market_uk, market_de, market_ca, market_au, market_fr

## âš ï¸ RÃˆGLES DE SÃ‰CURITÃ‰
- **Backup obligatoire** avant toute modification
- **Test de compilation** Python avant upload (py_compile)
- **Rollback immÃ©diat** si validation Ã©choue
- **VÃ©rification des effets de bord** AVANT de dire "c'est OK"
- **Test de dÃ©ploiement complet** sur le VPS
- **Validation utilisateur** obligatoire pour chaque modification
- **NE JAMAIS dire "c'est OK"** sans avoir testÃ© tous les composants

## ğŸš€ DÃ‰PLOIEMENT
- DÃ©velopper dans /test/
- DÃ©ployer vers les autres branches quand prÃªt
- Ne jamais modifier directement les autres branches
- Utiliser le systÃ¨me de rollback en cas de problÃ¨me

## ğŸ“š RÃ‰FÃ‰RENCES IMPORTANTES
- **Constitution**: .specify/memory/constitution.md
- **Documentation**: docs/analysis/ et specs/001-name-trendtrack-scraper/
- **ProcÃ©dures**: docs/procedures/metric_addition_procedure.md
- **Workspace**: README_WORKSPACE.md

## ğŸ”„ CHANGEMENTS RÃ‰CENTS (2025-09-18)
- **Chemins absolus â†’ relatifs** : Conversion complÃ¨te pour la portabilitÃ©
- **Scraper TrendTrack** : Fonctionne avec chemins relatifs (614 boutiques)
- **API** : Port 8001, chemins relatifs, lancement depuis /test/
- **Bases de donnÃ©es** : Chemins relatifs, scraper utilise trendtrack.db
- **RÃ¨gles de sÃ©curitÃ©** : RenforcÃ©es avec validation obligatoire

## ğŸ¯ Ã‰TAT ACTUEL
- âœ… **Scraper TrendTrack** : OpÃ©rationnel (screen actif)
- âœ… **Chemins relatifs** : ImplÃ©mentÃ©s dans tous les fichiers
- âœ… **Base de donnÃ©es** : 614 boutiques dans trendtrack.db
- âš ï¸ **API** : ProblÃ¨me de dÃ©marrage (non critique)
- âœ… **Menu workers** : Fonctionne avec chemins corrigÃ©s
